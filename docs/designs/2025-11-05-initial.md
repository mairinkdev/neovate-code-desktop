# neovate-code-desktop - Electron Boilerplate Design

## Overview

A minimal Electron boilerplate app with complete engineering infrastructure including build, dev, package scripts, and auto-updates via GitHub releases.

**Location:** `/Users/chencheng/Documents/Code/test/neovate-code-desktop`
**Target Platform:** macOS arm64
**UI Framework:** React + TypeScript
**Auto-Update:** GitHub Releases

---

## Architecture Overview

### Project Structure

```
neovate-code-desktop/
├── src/
│   ├── main/           # Electron main process (Node.js)
│   │   ├── main.ts     # Entry point, window creation
│   │   └── preload.ts  # Context bridge for IPC
│   ├── renderer/       # UI layer (React)
│   │   ├── App.tsx     # Root component (Hello World)
│   │   ├── main.tsx    # React entry
│   │   └── index.html  # HTML shell
│   └── shared/         # Types shared between processes
│       └── types.ts
├── dist/               # Compiled output (gitignored)
├── release/            # Packaged apps (gitignored)
├── package.json        # Dependencies & scripts
├── tsconfig.json       # TypeScript config for renderer
├── tsconfig.main.json  # TypeScript config for main
└── vite.config.ts      # Vite bundler config
```

### Core Architecture

- **Main process** manages app lifecycle, creates windows, handles system APIs
- **Renderer process** runs React UI in Chromium
- **Preload script** provides secure IPC bridge between main and renderer
- **Vite** bundles renderer, TypeScript compiles main process
- **electron-builder** packages the app with electron-updater for GitHub releases
- **Concurrent dev mode** runs both processes simultaneously with hot reload

---

## Dependencies & Scripts

### Core Dependencies

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@electron/rebuild": "^4.0.1",      // Rebuild native modules
    "electron": "^30.5.1",               // Framework
    "electron-builder": "^24.9.1",       // Packaging
    "electron-updater": "^6.3.9",        // Auto-updates
    "@vitejs/plugin-react": "^4.7.0",    // React in Vite
    "vite": "^5.0.10",                   // Renderer bundler
    "typescript": "^5.3.3",              // Type safety
    "@types/react": "^18.2.45",
    "@types/react-dom": "^18.2.18",
    "@types/node": "^20.10.0",
    "concurrently": "^8.2.2"             // Run dev servers
  }
}
```

### Essential Scripts

```json
{
  "scripts": {
    "dev": "concurrently \"npm run dev:main\" \"npm run dev:renderer\"",
    "dev:main": "tsc -p tsconfig.main.json && electron dist/main/main.ts --dev",
    "dev:renderer": "vite",
    "build": "npm run build:main && npm run build:renderer",
    "build:main": "tsc -p tsconfig.main.json",
    "build:renderer": "vite build",
    "package": "npm run build && electron-builder",
    "package:mac": "npm run build && electron-builder --mac",
    "postinstall": "electron-rebuild"
  }
}
```

### Workflow

- `npm run dev` → Hot reload for both processes during development
- `npm run build` → Compile TypeScript + bundle React
- `npm run package:mac` → Create DMG/ZIP for macOS arm64
- `postinstall` → Auto-rebuild native modules after npm install

---

## Configuration Files

### TypeScript Configuration

Two separate configs for main and renderer processes:

**tsconfig.json** (renderer):
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "jsx": "react-jsx",
    "moduleResolution": "bundler",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "outDir": "dist/renderer"
  },
  "include": ["src/renderer/**/*", "src/shared/**/*"]
}
```

**tsconfig.main.json** (main process):
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "commonjs",
    "lib": ["ES2022"],
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "outDir": "dist/main"
  },
  "include": ["src/main/**/*", "src/shared/**/*"]
}
```

**Why two TypeScript configs?** Main process runs in Node.js (CommonJS), renderer runs in browser (ESNext modules). Separate compilation targets ensure compatibility.

### Vite Configuration

**vite.config.ts**:
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  base: './',
  build: {
    outDir: 'dist/renderer'
  }
})
```

---

## Electron Builder & Auto-Update Configuration

### electron-builder configuration

In package.json:

```json
{
  "build": {
    "appId": "com.neovatecodedesktop",
    "productName": "neovate-code-desktop",
    "directories": {
      "output": "release"
    },
    "artifactName": "neovate-code-desktop-${arch}.${ext}",
    "publish": [
      {
        "provider": "github",
        "owner": "YOUR_GITHUB_USERNAME",
        "repo": "neovate-code-desktop"
      }
    ],
    "files": [
      "dist/**/*"
    ],
    "mac": {
      "category": "public.app-category.developer-tools",
      "target": [
        {
          "target": "dmg",
          "arch": ["arm64"]
        },
        {
          "target": "zip",
          "arch": ["arm64"]
        }
      ]
    }
  }
}
```

### Auto-Update Flow

1. App checks GitHub releases on startup using electron-updater
2. If new version exists, downloads in background
3. Prompts user to restart and install
4. Updates applied on restart

### Implementation

In main.ts:
```typescript
import { autoUpdater } from 'electron-updater'

// After app ready
autoUpdater.checkForUpdatesAndNotify()
```

### Release Process

1. Bump version in package.json
2. Run `npm run package:mac`
3. Create GitHub release with tag (e.g., v1.0.1)
4. Upload DMG and ZIP from `release/` folder
5. Users receive auto-update notification

---

## Application Code - Hello World Implementation

### Main Process

**src/main/main.ts:**
```typescript
import { app, BrowserWindow } from 'electron'
import { autoUpdater } from 'electron-updater'
import path from 'path'

let mainWindow: BrowserWindow | null = null

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      contextIsolation: true,
      nodeIntegration: false
    }
  })

  // Load renderer
  if (process.argv.includes('--dev')) {
    mainWindow.loadURL('http://localhost:5173')
    mainWindow.webContents.openDevTools()
  } else {
    mainWindow.loadFile(path.join(__dirname, '../renderer/index.html'))
  }

  // Check for updates
  autoUpdater.checkForUpdatesAndNotify()
}

app.whenReady().then(createWindow)

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') app.quit()
})
```

### Preload Script

**src/main/preload.ts:**
```typescript
import { contextBridge } from 'electron'

contextBridge.exposeInMainWorld('electron', {
  platform: process.platform
})
```

### React App

**src/renderer/App.tsx:**
```tsx
export default function App() {
  return (
    <div style={{ padding: '2rem', fontFamily: 'system-ui' }}>
      <h1>Hello World</h1>
      <p>Welcome to neovate-code-desktop</p>
      <p>Platform: {window.electron?.platform || 'unknown'}</p>
    </div>
  )
}
```

**src/renderer/main.tsx:**
```tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

### HTML Shell

**src/renderer/index.html:**
```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>neovate-code-desktop</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/main.tsx"></script>
  </body>
</html>
```

### Shared Types

**src/shared/types.ts:**
```typescript
declare global {
  interface Window {
    electron?: {
      platform: string
    }
  }
}

export {}
```

---

## Summary

This design provides a clean, minimal Electron boilerplate with:

- ✅ Complete engineering infrastructure (build, dev, package)
- ✅ TypeScript for type safety
- ✅ React for UI framework
- ✅ Vite for fast development and bundling
- ✅ electron-builder for packaging macOS apps
- ✅ electron-updater for GitHub releases auto-updates
- ✅ Secure IPC via preload script
- ✅ Hello World implementation ready to extend

**Next Steps:** Create implementation plan and build the project.
